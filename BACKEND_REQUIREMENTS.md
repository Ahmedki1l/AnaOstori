# ูุชุทูุจุงุช Backend APIs ูุฅุตูุงุญ ูุดุงูู ุงูุฏูุฑุงุช ุงููุณุฌูุฉ

## ุชุงุฑูุฎ ุงููุซููุฉ
**ุงูุชุงุฑูุฎ:** ุฏูุณูุจุฑ 2024  
**ุงููุณุฎุฉ:** 1.0  
**ุงูุญุงูุฉ:** ๐ ูุชุทูุจุงุช ููุชูููุฐ

---

## ููุฎุต ุชูููุฐู

ูุฐุง ุงูููู ูุญุชูู ุนูู ูุชุทูุจุงุช Backend APIs ุงููุทููุจุฉ ูุฏุนู ุงูุฅุตูุงุญุงุช ุงูุชู ุชู ุชุทุจูููุง ูู Frontend. ุจุนุถ ูุฐู ุงููุชุทูุจุงุช ูุฏ ุชููู ููุฌูุฏุฉ ุจุงููุนูุ ูุจุนุถูุง ูุญุชุงุฌ ุฅูู ุชุนุฏูู ุฃู ุฅุถุงูุฉ.

---

## API 1: `getItemByIdNoAuth` (ุฌุฏูุฏ ุฃู ุชุนุฏูู ููุฌูุฏ)

### ุงููุตู
API ูููุตูู ุฅูู ูุญุชูู ุงูุฏุฑูุณ (items) ุจุฏูู authenticationุ ูุน ุงูุณูุงุญ ุจุงููุตูู ููุฏุฑูุณ ุงููุฌุงููุฉ ููุท.

### Endpoint
```
GET /route/fetch?routeName=getItemByIdNoAuth&courseId={courseId}&itemId={itemId}
```

### Parameters
- `courseId` (required): ูุนุฑู ุงูุฏูุฑุฉ
- `itemId` (required): ูุนุฑู ุงูุฏุฑุณ/ุงูุนูุตุฑ

### Behavior
1. **ููุทูุงุจ ุบูุฑ ุงููุณุฌููู:**
   - ูุฌุจ ุงูุชุญูู ูู ุฃู `item.sectionItem.freeUsage === true`
   - ุฅุฐุง ูุงู `freeUsage === false`ุ ูุฌุจ ุฅุฑุฌุงุน ุฎุทุฃ 403 Forbidden
   - ุฅุฐุง ูุงู `freeUsage === true`ุ ูุฌุจ ุฅุฑุฌุงุน ุจูุงูุงุช ุงูุนูุตุฑ (URL ููููุฏูู/ุงูููู)

2. **ููุทูุงุจ ุงููุณุฌููู:**
   - ูุฌุจ ุงูุชุญูู ูู enrollment ูู ุงูุฏูุฑุฉ
   - ุฅุฐุง ูุงู ูุณุฌูุ ูุฌุจ ุฅุฑุฌุงุน ุจูุงูุงุช ุงูุนูุตุฑ ุจุบุถ ุงููุธุฑ ุนู `freeUsage`
   - ุฅุฐุง ูู ููู ูุณุฌูุ ูุฌุจ ุงุชุจุงุน ููุณ ููุงุนุฏ ุงูุทูุงุจ ุบูุฑ ุงููุณุฌููู

### Response Format
```json
{
  "data": {
    "id": "itemId",
    "name": "ุงุณู ุงูุฏุฑุณ",
    "description": "ูุตู ุงูุฏุฑุณ",
    "type": "video|file|quiz",
    "url": "https://...", // ููููุฏูู/ุงูููู
    "linkKey": "...",
    "linkBucket": "...",
    "sectionItem": {
      "freeUsage": true,
      "order": 1
    }
  }
}
```

### Error Responses
- `403 Forbidden`: ูุญุงููุฉ ุงููุตูู ููุญุชูู ุบูุฑ ูุฌุงูู ุจุฏูู enrollment
- `404 Not Found`: ุงูุนูุตุฑ ุบูุฑ ููุฌูุฏ
- `400 Bad Request`: ูุนุงููุงุช ุบูุฑ ุตุญูุญุฉ

---

## API 2: `getCourseCurriculumNoAuth` (ุชุนุฏูู ููุฌูุฏ)

### ุงููุตู
API ููุญุตูู ุนูู ูุญุชูู ุงูุฏูุฑุฉ ุจุฏูู authentication. ูุฌุจ ุฃู ูุนูุฏ ุฌููุน sections ู items ูุน ุฎุงุตูุฉ `freeUsage`.

### Endpoint
```
GET /route/fetch?routeName=getCourseCurriculumNoAuth&courseId={courseId}
```

### Behavior
1. ูุฌุจ ุฅุฑุฌุงุน ุฌููุน sections ู items
2. ูุฌุจ ุชุถููู `sectionItem.freeUsage` ููู item
3. **ูุง ูุฌุจ** ุฅุฑุฌุงุน `enrollment` ููุทูุงุจ ุบูุฑ ุงููุณุฌููู
4. ูุฌุจ ุชุฑุชูุจ sections ู items ุญุณุจ `order`

### Response Format
```json
{
  "data": {
    "course": {
      "id": "courseId",
      "name": "ุงุณู ุงูุฏูุฑุฉ"
    },
    "sections": [
      {
        "id": "sectionId",
        "name": "ุงุณู ุงููุณู",
        "order": 1,
        "items": [
          {
            "id": "itemId",
            "name": "ุงุณู ุงูุฏุฑุณ",
            "type": "video|file|quiz",
            "sectionItem": {
              "freeUsage": true,
              "order": 1
            }
          }
        ]
      }
    ]
  }
}
```

---

## API 3: `addItemToSection` (ุชุญุณูู ููุฌูุฏ)

### ุงููุตู
API ูุฅุถุงูุฉ ุนูุงุตุฑ ุฌุฏูุฏุฉ ุฅูู ูุณู ูู ุงูุฏูุฑุฉ. ูุฌุจ ุฃู ูุฏุนู `order` ููุนุงูู ุงุฎุชูุงุฑู.

### Endpoint
```
POST /route
```

### Request Body
```json
{
  "routeName": "addItemToSection",
  "sectionId": "sectionId",
  "items": [
    {
      "id": "itemId",
      "order": 1  // optional - if not provided, calculate automatically
    }
  ]
}
```

### Behavior
1. ุฅุฐุง ุชู ุฅุฑุณุงู `order` ูุน ุงูุนูุงุตุฑ:
   - ูุฌุจ ุงุณุชุฎุฏุงู ุงููููุฉ ุงููุฑุณูุฉ
   - ูุฌุจ ุงูุชุญูู ูู ุนุฏู ูุฌูุฏ duplicates ูู order
   - ุฅุฐุง ูุงู ููุงู duplicateุ ูุฌุจ ุฅุฑุฌุงุน ุฎุทุฃ

2. ุฅุฐุง ูู ูุชู ุฅุฑุณุงู `order`:
   - ูุฌุจ ุญุณุงุจ order ุชููุงุฆูุงู: `max(existing orders) + 1`
   - ูุฌุจ ุถูุงู ุนุฏู ูุฌูุฏ gaps ูู ุงูุชุฑุชูุจ

3. ูุฌุจ ุฅุฑุฌุงุน ูุงุฆูุฉ ุงูุนูุงุตุฑ ุงููุญุฏุซุฉ ูุน order ุงูุตุญูุญ

### Response Format
```json
{
  "data": {
    "items": [
      {
        "id": "itemId",
        "sectionItem": {
          "order": 1
        }
      }
    ]
  }
}
```

### Error Responses
- `400 Bad Request`: duplicate order ุฃู ูุนุงููุงุช ุบูุฑ ุตุญูุญุฉ
- `404 Not Found`: ุงููุณู ุบูุฑ ููุฌูุฏ

---

## API 4: `removeItemToSection` (ุชุญุณูู ููุฌูุฏ)

### ุงููุตู
API ูุญุฐู ุนูุตุฑ ูู ูุณู ูู ุงูุฏูุฑุฉ. ูุฌุจ ุฃู ูุนูุฏ ูุงุฆูุฉ ุงูุนูุงุตุฑ ุงููุชุจููุฉ ูุน ุชุฑุชูุจ ูุญุฏุซ.

### Endpoint
```
POST /route
```

### Request Body
```json
{
  "routeName": "removeItemToSection",
  "sectionId": "sectionId",
  "itemId": "itemId"
}
```

### Behavior
1. ุญุฐู ุงูุนูุตุฑ ูู ุงููุณู
2. **ุฅุนุงุฏุฉ ุชุฑุชูุจ ุงูุนูุงุตุฑ ุงููุชุจููุฉ ุชููุงุฆูุงู:**
   - ูุฌุจ ุฃู ุชุจุฏุฃ order ูู 1
   - ูุฌุจ ุฃู ุชููู ูุชุณูุณูุฉ ุจุฏูู gaps
   - ูุซุงู: ุฅุฐุง ูุงู ูุฏููุง [1, 2, 3, 4] ูุญุฐููุง 2ุ ูุฌุจ ุฃู ุชุตุจุญ [1, 2, 3]

3. ุฅุฑุฌุงุน ูุงุฆูุฉ ุงูุนูุงุตุฑ ุงููุชุจููุฉ ูุน order ูุญุฏุซ

### Response Format
```json
{
  "data": {
    "items": [
      {
        "id": "itemId1",
        "sectionItem": {
          "order": 1
        }
      },
      {
        "id": "itemId2",
        "sectionItem": {
          "order": 2
        }
      }
    ]
  }
}
```

### Error Responses
- `404 Not Found`: ุงูุนูุตุฑ ุฃู ุงููุณู ุบูุฑ ููุฌูุฏ
- `400 Bad Request`: ูุนุงููุงุช ุบูุฑ ุตุญูุญุฉ

---

## API 5: `updateSectionItem` (ุชุญุณูู ููุฌูุฏ)

### ุงููุตู
API ูุชุญุฏูุซ order ููุนูุงุตุฑ ูู ูุณู. ูุฌุจ ุฃู ูุฏุนู batch update.

### Endpoint
```
POST /route
```

### Request Body
```json
{
  "routeName": "updateSectionItem",
  "data": [
    {
      "sectionId": "sectionId",
      "itemId": "itemId1",
      "order": 1
    },
    {
      "sectionId": "sectionId",
      "itemId": "itemId2",
      "order": 2
    }
  ]
}
```

### Behavior
1. ูุฌุจ ุฃู ูุฏุนู ุชุญุฏูุซ order ูุนุฏุฉ items ูู ููุณ ุงูููุช (batch update)
2. ูุฌุจ ุงูุชุญูู ูู:
   - ุนุฏู ูุฌูุฏ duplicates ูู order ุฏุงุฎู ููุณ ุงููุณู
   - ุฃู order ูุจุฏุฃ ูู 1
   - ุฃู order ูุชุณูุณู (ุงุฎุชูุงุฑู - ูููู ุงูุณูุงุญ ุจ gaps)

3. ูุฌุจ ุฅุฑุฌุงุน confirmation ุฃู ูุงุฆูุฉ ุงูุนูุงุตุฑ ุงููุญุฏุซุฉ

### Response Format
```json
{
  "success": true,
  "message": "Order updated successfully"
}
```

### Error Responses
- `400 Bad Request`: duplicate order ุฃู ูุนุงููุงุช ุบูุฑ ุตุญูุญุฉ
- `404 Not Found`: ุฃุญุฏ ุงูุนูุงุตุฑ ุบูุฑ ููุฌูุฏ

---

## API 6: `courseById` (ุงูุชุญูู ูู ูุฌูุฏู)

### ุงููุตู
API ููุญุตูู ุนูู ุชูุงุตูู ุงูุฏูุฑุฉ ุจุงูู ID. ูุณุชุฎุฏู ูู redirect ุจุนุฏ ุชุณุฌูู ุงูุฏุฎูู ูู QR code.

### Endpoint
```
GET /route/fetch?routeName=courseById&courseId={courseId}
```

### Response Format
```json
{
  "data": {
    "id": "courseId",
    "name": "ุงุณู ุงูุฏูุฑุฉ",
    "catagory": {
      "name": "ุงุณู ุงููุฆุฉ"
    }
  }
}
```

---

## ููุงุญุธุงุช ุฅุถุงููุฉ

### ุงูุฃูุงู
1. **ููู APIs ุจุฏูู authentication:**
   - ูุฌุจ ุงูุชุฃูุฏ ูู ุฃู ุงูุทูุงุจ ุบูุฑ ุงููุณุฌููู ูุง ูููููู ุงููุตูู ูููุญุชูู ุงููุฏููุน
   - ูุฌุจ ุงูุชุญูู ูู `freeUsage` ูุจู ุฅุฑุฌุงุน ุฃู ูุญุชูู

2. **ููู APIs ูุน authentication:**
   - ูุฌุจ ุงูุชุญูู ูู enrollment ูุจู ุงูุณูุงุญ ุจุงููุตูู ูููุญุชูู ุงููุฏููุน
   - ูุฌุจ ุฅุฑุฌุงุน ุฎุทุฃ ูุงุถุญ ุฅุฐุง ูู ููู ุงููุณุชุฎุฏู ูุณุฌู

### ุงูุฃุฏุงุก
1. ุนูุฏ ุฅุนุงุฏุฉ ุชุฑุชูุจ ุงูุนูุงุตุฑุ ูุฌุจ ุงุณุชุฎุฏุงู transaction ุฃู batch update ูุชูููู ุนุฏุฏ ุงูุนูููุงุช
2. ูุฌุจ ุชุฌูุจ N+1 queries ุนูุฏ ุฌูุจ sections ู items

### ุงูุงุฎุชุจุงุฑ
ูุฌุจ ุงุฎุชุจุงุฑ ุฌููุน ุงูุณููุงุฑูููุงุช:
- ุฅุถุงูุฉ ุนูุตุฑ ูู ุงูุจุฏุงูุฉ
- ุฅุถุงูุฉ ุนูุตุฑ ูู ุงูููุชุตู
- ุฅุถุงูุฉ ุนูุตุฑ ูู ุงูููุงูุฉ
- ุญุฐู ุนูุตุฑ ูู ุงูุจุฏุงูุฉ
- ุญุฐู ุนูุตุฑ ูู ุงูููุชุตู
- ุญุฐู ุนูุตุฑ ูู ุงูููุงูุฉ
- ุงููุตูู ููุญุชูู ูุฌุงูู ุจุฏูู auth
- ูุญุงููุฉ ุงููุตูู ููุญุชูู ูุฏููุน ุจุฏูู auth (ูุฌุจ ุฑูุถ)
- ุงููุตูู ููุญุชูู ูุฏููุน ูุน auth ู enrollment (ูุฌุจ ุงูุณูุงุญ)

---

## ุฃููููุงุช ุงูุชูููุฐ

1. **ุนุงุฌู:**
   - `getItemByIdNoAuth` - ูุทููุจ ููุนููุงุช ุงููุฌุงููุฉ
   - ุชุญุณูู `removeItemToSection` - ูุทููุจ ูุฅุตูุงุญ ุชุฑุชูุจ ุงูููุฏูููุงุช

2. **ููู:**
   - ุชุญุณูู `addItemToSection` - ูุถูุงู order ุตุญูุญ ุนูุฏ ุงูุฅุถุงูุฉ
   - ุชุญุณูู `updateSectionItem` - ูุถูุงู batch update ูุนูู ุจุดูู ุตุญูุญ

3. **ุชุญุณููุงุช:**
   - `getCourseCurriculumNoAuth` - ูุฏ ูููู ููุฌูุฏ ุจุงููุนูุ ูุญุชุงุฌ ููุท ููุชุญูู

---

## ุงูุชูุงุตู

ูู ุญุงูุฉ ูุฌูุฏ ุฃู ุงุณุชูุณุงุฑุงุช ุฃู ุญุงุฌุฉ ูุชูุถูุญ ุฃู ูู ุงููุชุทูุจุงุชุ ูุฑุฌู ุงูุชูุงุตู ูุน ูุฑูู Frontend.

